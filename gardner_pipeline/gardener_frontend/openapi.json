{"openapi":"3.1.0","info":{"title":"Lotus Biological Agent API","description":"Backend engine for single-cell analysis","version":"0.1.0"},"paths":{"/api/v1/agent/history/sessions/create":{"post":{"tags":["Biological Agent Chat History"],"summary":"Create Chat Session","operationId":"create_chat_session_api_v1_agent_history_sessions_create_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateSessionRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/agent/history/sessions":{"get":{"tags":["Biological Agent Chat History"],"summary":"List Project Sessions","operationId":"list_project_sessions_api_v1_agent_history_sessions_get","parameters":[{"name":"project_id","in":"query","required":true,"schema":{"type":"string","title":"Project Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object"},"title":"Response List Project Sessions Api V1 Agent History Sessions Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/agent/history/sessions/rename/{session_id}":{"patch":{"tags":["Biological Agent Chat History"],"summary":"Rename Chat Session","operationId":"rename_chat_session_api_v1_agent_history_sessions_rename__session_id__patch","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RenameSessionRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/agent/history/sessions/delete/{session_id}":{"delete":{"tags":["Biological Agent Chat History"],"summary":"Delete Chat Session","operationId":"delete_chat_session_api_v1_agent_history_sessions_delete__session_id__delete","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/agent/history/{session_id}/message/create":{"post":{"tags":["Biological Agent Chat History"],"summary":"Create Message","description":"Unified endpoint to log User inputs, Agent thoughts, Tool calls, etc.\nDispatches to the correct service method based on `message_type`.","operationId":"create_message_api_v1_agent_history__session_id__message_create_post","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","description":"Session Business ID","title":"Session Id"},"description":"Session Business ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgentMessageRequest"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/agent/history/{session_id}/history/all":{"get":{"tags":["Biological Agent Chat History"],"summary":"Get Session History","description":"Get paginated history for UI rendering.","operationId":"get_session_history_api_v1_agent_history__session_id__history_all_get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Page"}},{"name":"size","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":20,"title":"Size"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/annotation/full":{"post":{"tags":["Biological Annotation"],"summary":"Run Full Annotation Pipeline","description":"Executes a consolidated annotation pipeline. Can run GSEApy (Enrichr), CellTypist, or both, based on the provided parameters. Saves all results into a single snapshot.","operationId":"run_full_annotation_pipeline_api_v1_annotation_full_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunFullAnnotationRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnnotationResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/annotation/gseapy/all":{"post":{"tags":["Biological Annotation"],"summary":"Run All Gseapy Cluster Annotation","description":"Run automated batch annotation for ALL clusters using GSEApy.\n\nThis endpoint iterates through every cluster defined in the DEG analysis,\nqueries Enrichr for each, and aggregates the results into a summary map.\n\nWorkflow:\n1. Loads the DEG snapshot.\n2. Identifies all available clusters.\n3. For each cluster:\n   - Extracts top marker genes.\n   - Queries Enrichr (specifically CellMarker database).\n   - Selects the top-ranked cell type.\n4. Saves a master JSON summary file mapping Cluster ID -> Cell Type & Confidence.\n5. Creates a snapshot linking to this summary.","operationId":"run_all_gseapy_cluster_annotation_api_v1_annotation_gseapy_all_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunAnnotationRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnnotationResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/annotation/celltypist":{"post":{"tags":["Biological Annotation"],"summary":"Run Celltypist Auto Annotation","description":"Run automated cell type annotation (CellTypist) for the entire dataset.\n\nWorkflow:\n1. Validates that the previous step (Clustering) exists via snapshot resolution.\n2. Loads the AnnData object from storage.\n3. Executes the CellTypist model to predict cell identities for every cell.\n4. Performs majority voting (optional) to assign dominant labels at the cluster level.\n5. Saves the prediction summary as a JSON file and creates a new database snapshot.","operationId":"run_celltypist_auto_annotation_api_v1_annotation_celltypist_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunCellTypistRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnnotationResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/annotation/gseapy/single":{"post":{"tags":["Biological Annotation"],"summary":"Run Single Gseapy Cluster Annotation","description":"Run functional enrichment analysis (GSEApy/Enrichr) for a SINGLE cluster.\n\nWorkflow:\n1. Validates that the previous step (DEG Analysis) exists.\n2. Extracts marker genes for the specified 'cluster_id'.\n3. Calls the external Enrichr API to identify cell types or pathways.\n4. Saves the results as a lightweight JSON file.\n5. Creates a metadata snapshot that links back to the original data matrix.","operationId":"run_single_gseapy_cluster_annotation_api_v1_annotation_gseapy_single_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunAnnotationRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnnotationResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/clustering/create":{"post":{"tags":["Analysis"],"summary":"Run Clustering & UMAP","description":"Performs community detection (Leiden/Louvain) at multiple resolutions and computes UMAP embeddings.","operationId":"run_clustering_api_v1_clustering_create_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunClusteringRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusteringResultDTO"}}}},"400":{"description":"Invalid resolution settings or unsupported method"},"404":{"description":"Source snapshot not found"},"500":{"description":"Clustering calculation failed (e.g., missing neighbors)"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/clustering/merge":{"post":{"tags":["Analysis"],"summary":"Merge Clusters","description":"Merges specified clusters into a single new group, updates the AnnData object, and regenerates visualizations (UMAP/Dendrogram) in a new snapshot.","operationId":"merge_clusters_api_v1_clustering_merge_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MergeClustersRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusteringResultDTO"}}}},"400":{"description":"Invalid cluster IDs or parameters"},"404":{"description":"Source snapshot not found"},"500":{"description":"Merge operation failed"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/dge/new":{"post":{"tags":["DGE"],"summary":"Differential Expression Gene (DGE) Analysis","description":"Identifies marker genes for each cluster using statistical tests (Wilcoxon/t-test) and generates visualization plots.","operationId":"run_deg_analysis_api_v1_dge_new_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunDGERequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DGEResultDTO"}}}},"400":{"description":"Invalid groupby column or insufficient groups (<2)"},"404":{"description":"Source snapshot not found"},"500":{"description":"Calculation failed (e.g., singular matrix, data integrity issues)"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/dim-reduction/pca":{"post":{"tags":["DimReduction"],"summary":"Run PCA Analysis","description":"Performs Principal Component Analysis on highly variable genes and returns Elbow Plot data.","operationId":"run_pca_analysis_api_v1_dim_reduction_pca_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunPCARequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PCAResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/dim-reduction/neighbors":{"post":{"tags":["DimReduction"],"summary":"Build Neighborhood Graph","description":"Computes cell-cell neighbor relations based on a specified number of PCs.","operationId":"build_neighborhood_graph_api_v1_dim_reduction_neighbors_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunNeighborsRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NeighborsResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/preprocessing/run/full":{"post":{"tags":["Preprocessing"],"summary":"Full Preprocessing Pipeline","description":"Runs the complete preprocessing pipeline (QC -> Filter -> HVG -> PCA -> Neighbors) in memory and saves a single snapshot.","operationId":"run_full_preprocessing_api_v1_preprocessing_run_full_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FullPreprocessingRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FullPreprocessingResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/preprocessing/qc/calculate":{"post":{"tags":["Preprocessing"],"summary":"Perform Qc Calculation","description":"Calculate QC Metrics.","operationId":"perform_qc_calculation_api_v1_preprocessing_qc_calculate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CalculateQCRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/QCResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/preprocessing/qc/filter":{"post":{"tags":["Preprocessing"],"summary":"Apply Qc Filter","description":"Apply QC Filtering (Step 2).\n\nThis endpoint:\n1. Accepts filtering thresholds (min_genes, mt_pct, etc.).\n2. Physically filters the AnnData object.\n3. Creates a new Snapshot (H5AD file + DB Record).","operationId":"apply_qc_filter_api_v1_preprocessing_qc_filter_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterQCRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterQCResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/preprocessing/hvg":{"post":{"tags":["Preprocessing"],"summary":"Feature Selection & Scaling","description":"Performs Normalization -> Log1p -> HVG Identification -> Raw Backup -> Scaling.","operationId":"apply_hvg_api_v1_preprocessing_hvg_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunHVGRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HVGResultDTO"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/project/create":{"post":{"tags":["Project Management"],"summary":"Create New Project","description":"Creates a new empty project workspace with metadata.","operationId":"create_new_project_api_v1_project_create_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateProjectRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/project/dataset/import":{"post":{"tags":["Project Management"],"summary":"Import Dataset to Project","description":"Ingests a raw dataset file from a local path into an existing project.","operationId":"create_new_dataset_api_v1_project_dataset_import_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateDatasetRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/pipeline/run":{"post":{"tags":["Whole Pipeline Automation"],"summary":"Run Whole Pipeline","operationId":"run_whole_pipeline_api_v1_pipeline_run_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunWholePipelineRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunWholePipelineResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/methods/annotation/search":{"get":{"tags":["Annotation Reference Methods"],"summary":"Search Annotation Methods","description":"Search for reference methods (GSEApy libraries or CellTypist models) by keyword and type.","operationId":"search_annotation_methods_api_v1_methods_annotation_search_get","parameters":[{"name":"keyword","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"default":"","title":"Keyword"}},{"name":"type","in":"query","required":false,"schema":{"type":"string","default":"all","title":"Type"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/AnnotationMethodResponse"},"title":"Response Search Annotation Methods Api V1 Methods Annotation Search Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/snapshots/query/{snapshot_id}":{"get":{"tags":["Analysis Snapshots"],"summary":"Query Snapshot Details (Parameters & Metrics)","description":"Retrieves experiment details. Returns 'input' (parameters) and 'output' (biological metrics), automatically excluding heavy file paths.","operationId":"query_snapshot_detail_api_v1_snapshots_query__snapshot_id__get","parameters":[{"name":"snapshot_id","in":"path","required":true,"schema":{"type":"string","description":"The unique business ID of the snapshot","title":"Snapshot Id"},"description":"The unique business ID of the snapshot"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SnapshotQueryResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/snapshots/stage/query/":{"get":{"tags":["Analysis Snapshots"],"summary":"Query Latest Snapshot by Stage","description":"Retrieves the most recent snapshot for a specific dataset and analysis branch (e.g., 'Preprocessing'). Returns inputs and outputs.","operationId":"query_latest_stage_snapshot_api_v1_snapshots_stage_query__get","parameters":[{"name":"dataset_id","in":"query","required":true,"schema":{"type":"string","description":"The business ID of the dataset","title":"Dataset Id"},"description":"The business ID of the dataset"},{"name":"branch_name","in":"query","required":true,"schema":{"type":"string","description":"The branch name (e.g., 'Preprocessing', 'Clustering')","title":"Branch Name"},"description":"The branch name (e.g., 'Preprocessing', 'Clustering')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SnapshotQueryResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/snapshots/create":{"post":{"tags":["Analysis Snapshots"],"summary":"Create Snapshot","description":"Create a new analysis snapshot manually.","operationId":"create_snapshot_api_v1_snapshots_create_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateSnapshotRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SnapshotResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/snapshots/update/{snapshot_id}":{"patch":{"tags":["Analysis Snapshots"],"summary":"Update Snapshot","description":"Update snapshot metadata (e.g., add user notes or rename branch).","operationId":"update_snapshot_api_v1_snapshots_update__snapshot_id__patch","parameters":[{"name":"snapshot_id","in":"path","required":true,"schema":{"type":"string","title":"Snapshot Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateSnapshotRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SnapshotResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/snapshots/delete/{snapshot_id}":{"delete":{"tags":["Analysis Snapshots"],"summary":"Delete Snapshot","description":"Delete a snapshot record.","operationId":"delete_snapshot_api_v1_snapshots_delete__snapshot_id__delete","parameters":[{"name":"snapshot_id","in":"path","required":true,"schema":{"type":"string","title":"Snapshot Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/health":{"get":{"summary":"Health Check","description":"Health check endpoint for frontend readiness detection.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AgentMessageRequest":{"properties":{"message_type":{"type":"string","title":"Message Type","description":"Event type: user_input, agent_thought, tool_call, tool_result, agent_final"},"data":{"type":"object","title":"Data","description":"Dynamic payload matching the message type requirements."}},"type":"object","required":["message_type","data"],"title":"AgentMessageRequest","description":"Unified payload for logging any agent event.\nThe 'payload' structure depends on 'message_type'."},"AnnotationMethodResponse":{"properties":{"id":{"type":"integer","title":"Id"},"method_name":{"type":"string","title":"Method Name"},"type":{"type":"string","title":"Type"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"species":{"type":"string","title":"Species"},"organ":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Organ"}},"type":"object","required":["id","method_name","type","species"],"title":"AnnotationMethodResponse","description":"Response DTO returning method details."},"AnnotationResultDTO":{"properties":{"snapshot_id":{"type":"string","title":"Snapshot Id"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"cluster_id":{"anyOf":[{"type":"string"},{"items":{},"type":"array"},{"type":"null"}],"title":"Cluster Id"},"enrichment_results":{"type":"object","title":"Enrichment Results"},"msg":{"type":"string","title":"Msg"}},"type":"object","required":["snapshot_id","snapshot_path","cluster_id","enrichment_results","msg"],"title":"AnnotationResultDTO"},"CalculateQCRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"Unique project business ID"},"dataset_id":{"type":"string","title":"Dataset Id","description":"Unique dataset business ID"},"organism":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Organism","description":"Organism type (Human/Mouse) for gene prefix detection","default":"Human"},"custom_prefixes":{"anyOf":[{"additionalProperties":{"type":"string"},"type":"object"},{"type":"null"}],"title":"Custom Prefixes","description":"Custom gene prefixes (e.g., {'mt': 'MT-'})"}},"type":"object","required":["project_id","dataset_id"],"title":"CalculateQCRequest","description":"Request DTO for QC calculation parameters."},"ClusteringResultDTO":{"properties":{"snapshot_id":{"type":"string","title":"Snapshot Id"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"umap_plot_path":{"type":"string","title":"Umap Plot Path"},"dendrogram_path":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Dendrogram Path"},"clusters_summary":{"additionalProperties":{"type":"integer"},"type":"object","title":"Clusters Summary"},"msg":{"type":"string","title":"Msg"}},"type":"object","required":["snapshot_id","snapshot_path"],"title":"ClusteringResultDTO"},"CreateDatasetRequest":{"properties":{"project_id":{"type":"string","title":"Project Id"},"local_file_path":{"type":"string","title":"Local File Path"},"organism":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Organism"},"tissue_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tissue Type"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"dataset_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Dataset Name"}},"type":"object","required":["project_id","local_file_path"],"title":"CreateDatasetRequest","description":"Request body for importing a raw dataset into an existing project."},"CreateProjectRequest":{"properties":{"project_name":{"type":"string","title":"Project Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"}},"type":"object","required":["project_name"],"title":"CreateProjectRequest","description":"Request body for creating a new empty project workspace."},"CreateSessionRequest":{"properties":{"project_id":{"type":"string","title":"Project Id"},"initial_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Initial Name","default":"New Bio Analysis"},"agent_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Agent Name","default":"default"}},"type":"object","required":["project_id"],"title":"CreateSessionRequest"},"CreateSnapshotRequest":{"properties":{"dataset_id":{"type":"string","title":"Dataset Id"},"snapshot_id":{"type":"string","title":"Snapshot Id"},"branch_name":{"type":"string","title":"Branch Name"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"parent_snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Parent Snapshot Id"},"params_json":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Params Json","default":{}},"thumbnail_json":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Thumbnail Json","default":{}},"user_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Notes"}},"type":"object","required":["dataset_id","snapshot_id","branch_name","snapshot_path"],"title":"CreateSnapshotRequest"},"DGEResultDTO":{"properties":{"snapshot_id":{"type":"string","title":"Snapshot Id"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"csv_path":{"type":"string","title":"Csv Path"},"rank_genes_plot":{"type":"string","title":"Rank Genes Plot"},"dotplot":{"type":"string","title":"Dotplot"},"heatmap":{"type":"string","title":"Heatmap"},"violin":{"type":"string","title":"Violin"},"top_markers":{"additionalProperties":{"items":{"type":"string"},"type":"array"},"type":"object","title":"Top Markers"},"msg":{"type":"string","title":"Msg"}},"type":"object","required":["snapshot_id","snapshot_path","csv_path","rank_genes_plot","dotplot","heatmap","violin","top_markers","msg"],"title":"DGEResultDTO"},"FilterQCRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"Project Business ID"},"dataset_id":{"type":"string","title":"Dataset Id","description":"Source Dataset Business ID (Root for this snapshot)"},"min_genes":{"type":"integer","title":"Min Genes","description":"Minimum number of genes per cell","default":200},"min_cells":{"type":"integer","title":"Min Cells","description":"Minimum number of cells per gene","default":3},"max_counts":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Counts","description":"Maximum total counts per cell"},"pct_mt_max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pct Mt Max","description":"Maximum mitochondrial percentage (0-100)"},"pct_hb_max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pct Hb Max","description":"Maximum hemoglobin percentage (0-100)"}},"type":"object","required":["project_id","dataset_id"],"title":"FilterQCRequest","description":"Request DTO for applying QC filters."},"FilterQCResponse":{"properties":{"snapshot_id":{"type":"string","title":"Snapshot Id","description":"Unique ID of the generated snapshot"},"snapshot_path":{"type":"string","title":"Snapshot Path","description":"Path to the saved H5AD snapshot"},"n_obs_remaining":{"type":"integer","title":"N Obs Remaining","description":"Number of cells remaining after filtering"},"n_vars_remaining":{"type":"integer","title":"N Vars Remaining","description":"Number of genes remaining after filtering"}},"type":"object","required":["snapshot_id","snapshot_path","n_obs_remaining","n_vars_remaining"],"title":"FilterQCResponse","description":"Response DTO after applying filtering."},"FullPreprocessingRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"organism":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Organism","description":"Organism type (Human/Mouse) for gene prefix detection","default":"Human"},"custom_prefixes":{"anyOf":[{"additionalProperties":{"type":"string"},"type":"object"},{"type":"null"}],"title":"Custom Prefixes","description":"Custom gene prefixes (e.g., {'mt': 'MT-'})"},"skip_qc_calculation":{"type":"boolean","title":"Skip Qc Calculation","description":"Skip QC metrics calculation","default":false},"skip_qc_filter":{"type":"boolean","title":"Skip Qc Filter","description":"Skip QC filtering","default":false},"skip_hvg":{"type":"boolean","title":"Skip Hvg","description":"Skip HVG selection","default":false},"skip_pca":{"type":"boolean","title":"Skip Pca","description":"Skip PCA computation","default":false},"skip_neighbors":{"type":"boolean","title":"Skip Neighbors","description":"Skip neighbor graph construction","default":false},"min_genes":{"type":"integer","title":"Min Genes","description":"Minimum number of genes per cell","default":200},"cell_min_counts":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Cell Min Counts","description":"Minimum total counts per cell"},"max_genes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Genes","description":"Maximum number of genes per cell"},"cell_max_counts":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Cell Max Counts","description":"Maximum total counts per cell"},"min_cells":{"type":"integer","title":"Min Cells","description":"Minimum number of cells expressing a gene","default":3},"gene_min_counts":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Gene Min Counts","description":"Minimum total counts per gene"},"max_cells":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Cells","description":"Maximum number of cells expressing a gene"},"gene_max_counts":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Gene Max Counts","description":"Maximum total counts per gene"},"pct_mt_max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pct Mt Max","description":"Maximum mitochondrial percentage (0â100)"},"pct_hb_max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pct Hb Max","description":"Maximum hemoglobin percentage (0â100)"},"n_top_genes":{"type":"integer","maximum":10000.0,"minimum":500.0,"title":"N Top Genes","description":"Number of HVGs to select","default":2000},"flavor":{"type":"string","enum":["seurat","cell_ranger","seurat_v3"],"title":"Flavor","description":"HVG selection method","default":"seurat"},"target_sum":{"type":"number","title":"Target Sum","description":"Target total counts per cell for normalization","default":10000.0},"n_comps":{"type":"integer","title":"N Comps","description":"Number of PCA components","default":50},"svd_solver":{"type":"string","title":"Svd Solver","description":"SVD solver for PCA","default":"arpack"},"n_neighbors":{"type":"integer","title":"N Neighbors","description":"Number of neighbors","default":15},"n_pcs":{"type":"integer","title":"N Pcs","description":"Number of PCs used to build neighbor graph","default":30}},"type":"object","title":"FullPreprocessingRequest","description":"Request DTO for running the full preprocessing pipeline.\n\nPipeline:\nQC Calculation -> QC Filter -> HVG -> PCA -> Neighbors\n\nThe entire pipeline operates on a single AnnData object.\nIntermediate steps do NOT persist snapshots."},"FullPreprocessingResponse":{"properties":{"project_id":{"type":"string","title":"Project Id"},"dataset_id":{"type":"string","title":"Dataset Id"},"snapshot_id":{"type":"string","title":"Snapshot Id"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"executed_steps":{"items":{"type":"string"},"type":"array","title":"Executed Steps"},"skipped_steps":{"items":{"type":"string"},"type":"array","title":"Skipped Steps"},"final_stage":{"type":"string","title":"Final Stage"},"message":{"type":"string","title":"Message","default":"Preprocessing pipeline completed successfully."}},"type":"object","required":["project_id","dataset_id","snapshot_id","snapshot_path","executed_steps","skipped_steps","final_stage"],"title":"FullPreprocessingResponse","description":"Response DTO for one-shot preprocessing pipeline execution."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HVGResultDTO":{"properties":{"snapshot_id":{"type":"string","title":"Snapshot Id"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"hvg_plot_path":{"type":"string","title":"Hvg Plot Path"},"n_genes_found":{"type":"integer","title":"N Genes Found"},"msg":{"type":"string","title":"Msg","default":"HVG selection and scaling complete."}},"type":"object","required":["snapshot_id","snapshot_path","hvg_plot_path","n_genes_found"],"title":"HVGResultDTO"},"MergeClustersRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"method":{"type":"string","title":"Method"},"clusters_to_merge":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"items":{"type":"integer"},"type":"array"},{"items":{"type":"number"},"type":"array"}],"title":"Clusters To Merge"},"new_label":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"New Label"}},"type":"object","required":["method","clusters_to_merge"],"title":"MergeClustersRequest"},"NeighborsResultDTO":{"properties":{"snapshot_path":{"type":"string","title":"Snapshot Path"},"snapshot_id":{"type":"string","title":"Snapshot Id"},"n_connectivities":{"type":"integer","title":"N Connectivities"}},"type":"object","required":["snapshot_path","snapshot_id","n_connectivities"],"title":"NeighborsResultDTO"},"PCAResultDTO":{"properties":{"variance_plot_data":{"items":{"type":"number"},"type":"array","title":"Variance Plot Data"},"pca_scatter_path":{"type":"string","title":"Pca Scatter Path"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"snapshot_id":{"type":"string","title":"Snapshot Id"}},"type":"object","required":["variance_plot_data","pca_scatter_path","snapshot_path","snapshot_id"],"title":"PCAResultDTO"},"ProjectResponse":{"properties":{"project_id":{"type":"string","title":"Project Id"},"project_name":{"type":"string","title":"Project Name"},"dataset_id":{"type":"string","title":"Dataset Id"},"dataset_name":{"type":"string","title":"Dataset Name"},"workspace_path":{"type":"string","title":"Workspace Path"}},"type":"object","required":["project_id","project_name","dataset_id","dataset_name","workspace_path"],"title":"ProjectResponse"},"QCResultDTO":{"properties":{"dataset_id":{"type":"string","title":"Dataset Id"},"metrics_json_path":{"type":"string","title":"Metrics Json Path"},"violin_plot_path":{"type":"string","title":"Violin Plot Path"},"scatter_mt_path":{"type":"string","title":"Scatter Mt Path"},"scatter_genes_path":{"type":"string","title":"Scatter Genes Path"}},"type":"object","required":["dataset_id","metrics_json_path","violin_plot_path","scatter_mt_path","scatter_genes_path"],"title":"QCResultDTO"},"RenameSessionRequest":{"properties":{"new_name":{"type":"string","title":"New Name"}},"type":"object","required":["new_name"],"title":"RenameSessionRequest"},"RunAnnotationRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"top_n_genes":{"type":"integer","title":"Top N Genes","default":100},"cluster_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cluster Id","default":"ALL"},"categories":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Categories"}},"type":"object","title":"RunAnnotationRequest"},"RunCellTypistRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"model_names":{"items":{"type":"string"},"type":"array","title":"Model Names","description":"List of CellTypist models to apply (e.g. ['Immune_All_Low.pkl', 'Human_Lung_Atlas.pkl'])","default":["Immune_All_Low.pkl"]},"majority_voting":{"type":"boolean","title":"Majority Voting","default":true},"target_cluster_col":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Target Cluster Col","default":"leiden"}},"type":"object","title":"RunCellTypistRequest","description":"Request DTO for CellTypist automated cell type annotation."},"RunClusteringRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"method":{"type":"string","enum":["leiden","louvain","cplearn"],"title":"Method","default":"leiden"},"resolution":{"type":"number","title":"Resolution","description":"List of resolutions to test","default":0.5},"run_hierarchical":{"type":"boolean","title":"Run Hierarchical","default":true}},"type":"object","title":"RunClusteringRequest"},"RunDGERequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"groupby":{"type":"string","title":"Groupby","description":"Column in adata.obs to group by (usually clustering result)","default":"leiden"},"method":{"type":"string","enum":["wilcoxon","t-test","logreg"],"title":"Method","description":"Statistical test method","default":"wilcoxon"},"n_top_genes":{"type":"integer","maximum":100.0,"minimum":5.0,"title":"N Top Genes","description":"Number of top genes to visualize","default":25},"use_raw":{"type":"boolean","title":"Use Raw","description":"Whether to use adata.raw for calculation","default":true}},"type":"object","title":"RunDGERequest"},"RunFullAnnotationRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"top_n_genes":{"type":"integer","title":"Top N Genes","default":100},"categories":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Categories","description":"List of Enrichr libraries (e.g. ['cellmarker', 'human_gene_atlas']). Pass empty list or null to skip.","default":["cellmarker"]},"model_names":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Model Names","description":"List of CellTypist models. Pass empty list or null to skip.","default":["Immune_All_Low.pkl"]},"majority_voting":{"type":"boolean","title":"Majority Voting","default":true},"target_cluster_col":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Target Cluster Col","default":"leiden"}},"type":"object","title":"RunFullAnnotationRequest"},"RunHVGRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"n_top_genes":{"type":"integer","maximum":10000.0,"minimum":500.0,"title":"N Top Genes","description":"Target number of HVGs","default":2000},"flavor":{"type":"string","enum":["seurat","cell_ranger","seurat_v3"],"title":"Flavor","default":"seurat"},"target_sum":{"type":"number","title":"Target Sum","default":10000.0}},"type":"object","title":"RunHVGRequest"},"RunNeighborsRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"n_neighbors":{"type":"integer","title":"N Neighbors","default":15},"n_pcs":{"type":"integer","title":"N Pcs","default":30}},"type":"object","title":"RunNeighborsRequest"},"RunPCARequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"n_comps":{"type":"integer","title":"N Comps","default":50},"svd_solver":{"type":"string","title":"Svd Solver","default":"arpack"}},"type":"object","title":"RunPCARequest"},"RunWholePipelineRequest":{"properties":{"project_id":{"type":"string","title":"Project Id","description":"The business ID of the project"},"dataset_id":{"type":"string","title":"Dataset Id","description":"The business ID of the dataset"},"snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Snapshot Id","description":"The specific snapshot ID to operate on"},"preprocessing_params":{"anyOf":[{"$ref":"#/components/schemas/FullPreprocessingRequest"},{"type":"null"}]},"clustering_params":{"$ref":"#/components/schemas/RunClusteringRequest"},"deg_params":{"anyOf":[{"$ref":"#/components/schemas/RunDGERequest"},{"type":"null"}]},"annotation_params":{"anyOf":[{"$ref":"#/components/schemas/RunFullAnnotationRequest"},{"type":"null"}]}},"type":"object","required":["clustering_params"],"title":"RunWholePipelineRequest"},"RunWholePipelineResponse":{"properties":{"pipeline_run_id":{"type":"string","title":"Pipeline Run Id","description":"Unique ID for this pipeline execution"},"final_snapshot_id":{"type":"string","title":"Final Snapshot Id","description":"Snapshot ID of the final result"},"status":{"type":"string","title":"Status","description":"Execution status","default":"SUCCESS"},"msg":{"type":"string","title":"Msg","description":"Result message","default":"Whole pipeline executed successfully."},"steps_completed":{"items":{"type":"string"},"type":"array","title":"Steps Completed","example":["QC","HVG","PCA","Neighbors","Clustering","DEG","Annotation"]},"snapshots":{"additionalProperties":{"type":"string"},"type":"object","title":"Snapshots","example":{"clustering":"s_cluster_2","qc":"s_qc_1"}}},"type":"object","required":["pipeline_run_id","final_snapshot_id","steps_completed","snapshots"],"title":"RunWholePipelineResponse","description":"Response payload returning the execution status and generated snapshots."},"SnapshotQueryResponse":{"properties":{"snapshot_id":{"type":"string","title":"Snapshot Id"},"branch_name":{"type":"string","title":"Branch Name"},"create_time":{"type":"string","format":"date-time","title":"Create Time"},"user_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Notes"},"input":{"type":"object","title":"Input"},"output":{"type":"object","title":"Output"}},"type":"object","required":["snapshot_id","branch_name","create_time","input","output"],"title":"SnapshotQueryResponse","description":"Response DTO for querying a single snapshot's details.\nSeparates experiment parameters (input) from biological metrics (output)."},"SnapshotResponse":{"properties":{"id":{"type":"integer","title":"Id"},"dataset_id":{"type":"string","title":"Dataset Id"},"snapshot_id":{"type":"string","title":"Snapshot Id"},"branch_name":{"type":"string","title":"Branch Name"},"snapshot_path":{"type":"string","title":"Snapshot Path"},"parent_snapshot_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Parent Snapshot Id"},"params_json":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Params Json"},"thumbnail_json":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Thumbnail Json"},"user_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Notes"},"create_time":{"type":"string","format":"date-time","title":"Create Time"},"end_time":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"End Time"}},"type":"object","required":["id","dataset_id","snapshot_id","branch_name","snapshot_path","create_time"],"title":"SnapshotResponse"},"UpdateSnapshotRequest":{"properties":{"branch_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Branch Name"},"user_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Notes"},"params_update":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Params Update"}},"type":"object","title":"UpdateSnapshotRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
